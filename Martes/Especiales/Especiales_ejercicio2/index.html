<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Tabla Padre</title>
  <style>
    :root{
      --header-h: 70px;
      --footer-h: 40px;
      --table-footer-h: 50px;
    }
    
    html,body{
      height:100%;
      margin:0;
      padding:0;
    }

    body{
      display:flex;
      flex-direction:column;
      height:100vh;
      background:#f9f9dc;
    }

    header.app-header{
      height:var(--header-h);
      display:flex;
      align-items:center;
      justify-content:space-between;
      padding:10px 16px;
      box-sizing:border-box;
      background:#f9f9dc;
      border-bottom:1px solid #999;
    }
    header.app-header h1{
      margin:0;
      font-size:14px;
      font-weight:bold;
    }
    .controls{
      display:flex;
      gap:10px;
    }
    .controls button{
      padding:6px 12px;
      border:1px solid #666;
      background:#fff;
      cursor:pointer;
    }

    .table-viewport{
      margin:10px;
      border:2px solid #333;
      background:#fff;
      display:flex;
      flex-direction:column;
      flex:1 1 auto;
      min-height:0;
      box-sizing:border-box;
    }

    .head-wrap {
      background:#ff9999;
    }
    .head-wrap table {
      width:100%;
      border-collapse:collapse;
      table-layout:fixed;
    }
    .head-wrap th{
      padding:8px;
      text-align:center;
      border-right:1px solid #ccc;
      font-size:12px;
    }

    .body-wrap {
      flex:1 1 auto;
      min-height:0;
      overflow:auto;
      background:#ddd;
    }
    .body-wrap table{
      width:100%;
      border-collapse:collapse;
      table-layout:fixed;
    }
    .body-wrap td{
      padding:6px;
      text-align:center;
      border-bottom:1px solid #ccc;
      font-size:12px;
    }

    .foot-wrap {
      height:var(--table-footer-h);
      background:#ff9999;
      box-sizing:border-box;
    }
    .foot-wrap table{
      width:100%;
      border-collapse:collapse;
      table-layout:fixed;
      height:100%;
    }
    .foot-wrap td{
      padding:6px;
      text-align:center;
      border-left:1px solid #ccc;
      font-size:12px;
      font-weight:bold;
    }

    footer.page-footer{
      height:var(--footer-h);
      background:#f9f9dc;
      border-top:1px solid #999;
      display:flex;
      align-items:center;
      justify-content:center;
      font-weight:bold;
    }
  </style>
  </head>

<body>

  <header class="app-header">
    <h1>Art√≠culos</h1>
    <div class="controls">
      <button id="loadBtn">Cargar datos</button>
      <button id="clearBtn">Vaciar datos</button>
    </div>
  </header>

  <div class="table-viewport">
    <div class="head-wrap">
      <table>
        <colgroup id="headCols"></colgroup>
        <thead><tr id="tableHead"></tr></thead>
      </table>
    </div>

    <div class="body-wrap">
      <table>
        <colgroup id="bodyCols"></colgroup>
        <tbody id="tableBody"></tbody>
      </table>
    </div>

    <div class="foot-wrap">
      <table>
        <colgroup id="footCols"></colgroup>
        <tfoot><tr id="tableFoot"></tr></tfoot>
      </table>
    </div>
  </div>

  <footer class="page-footer">Pie</footer>

  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  <script>
    (function($){
      const JSON_FILE = "TablaPadre.json";
      let columns = [];
      let rows = [];

      function esc(s){
        return String(s ?? "").replace(/&/g,"&amp;")
                              .replace(/</g,"&lt;")
                              .replace(/>/g,"&gt;");
      }

      function buildCols(n){
        if(n<=0) return "";
        let pct = (100/n).toFixed(2) + "%";
        return "<col style='width:"+pct+"'>".repeat(n);
      }

      function renderHeadAndFoot(){
        $("#headCols").html(buildCols(columns.length));
        $("#bodyCols").html(buildCols(columns.length));
        $("#footCols").html(buildCols(columns.length));

        $("#tableHead").empty();
        $("#tableFoot").empty();
        columns.forEach(c=>{
          $("#tableHead").append(`<th>${esc(c)}</th>`);
          $("#tableFoot").append(`<td>sum ${esc(c)}</td>`);
        });
      }

      function renderBody(){
        const $tbody = $("#tableBody").empty();
        rows.forEach(r=>{
          let tr="<tr>";
          columns.forEach(c=>{
            tr += `<td>${esc(r[c])}</td>`;
          });
          tr+="</tr>";
          $tbody.append(tr);
        });
      }

      function findArray(obj){
        if(Array.isArray(obj)) return obj;
        for(const k in obj){
          if(Array.isArray(obj[k])) return obj[k];
        }
        return null;
      }

      $(function(){
        $.getJSON(JSON_FILE).done(function(data){
          rows = findArray(data) || [];
          const set = new Set();
          rows.forEach(r=>{
            if(r && typeof r==="object"){
              Object.keys(r).forEach(k=>set.add(k));
            }
          });
          columns = Array.from(set);
          if(columns.length===0) columns=["(sin columnas)"];
          renderHeadAndFoot();
        });

        $("#loadBtn").click(()=> renderBody());
        $("#clearBtn").click(()=> $("#tableBody").empty());
      });
    })(jQuery);
  </script>

</body>
</html>